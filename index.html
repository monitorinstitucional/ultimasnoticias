<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Atualiza√ß√µes - STF</title>

<style>
:root{
  --bg:#0b0c10;--card:#12141b;--txt:#e9eefc;--muted:#a6adbb;
  --line:#222635;--brand:#1f6feb;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--txt)}
header{position:sticky;top:0;background:rgba(11,12,16,.95);
  backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:10}
.wrap{max-width:1100px;margin:0 auto;padding:16px}
h1{margin:0 0 6px;font-size:18px}
.subhead{margin:0;font-size:12px;color:var(--muted)}
button{border:1px solid var(--line);background:var(--card);color:var(--txt);
  border-radius:12px;padding:10px 12px;font-size:14px;cursor:pointer}
button.primary{background:var(--brand);border-color:var(--brand)}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.status{font-size:12px;color:var(--muted);margin-top:8px}
.grid{display:grid;gap:12px;padding:16px}
.card{background:var(--card);border:1px solid var(--line);
  border-radius:16px;padding:14px}
.pill{display:inline-block;padding:6px 10px;border-radius:999px;
  font-size:12px;border:1px solid var(--line);color:var(--muted)}
.title{margin:8px 0;font-size:16px;font-weight:700}
.title a{color:var(--txt);text-decoration:none}
.title a:hover{text-decoration:underline}
.date{font-size:12px;color:var(--muted)}
.link{font-size:12px;margin-top:6px}
.actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
footer{padding:16px;font-size:12px;color:var(--muted)}
</style>
</head>

<body>

<header>
  <div class="wrap">
    <h1>Atualiza√ß√£o autom√°tica ‚Äî STF</h1>
    <p class="subhead">√öltimas 24h ‚Ä¢ Ordenado do mais recente</p>
    <div class="row">
      <button id="refreshBtn" class="primary">Atualizar</button>
      <button id="summaryBtn">Resumo WhatsApp</button>
    </div>
    <div class="status" id="status">Pronto.</div>
  </div>
</header>

<main class="wrap">
  <div class="grid" id="list"></div>
</main>

<footer class="wrap">
  Agregador de links p√∫blicos. Conte√∫do pertence aos ve√≠culos.
</footer>

<script>
/* ================= CONFIG ================= */
const DISPLAY_HOURS = 24;
const SUMMARY_HOURS = 12;
const KEYWORDS = ["stf","supremo","alexandre de moraes","gilmar","dino","fachin","toffoli","fux","zanin","mendon√ßa","nunes marques"];

const FEEDS = [
  {name:"O Globo",url:"https://news.google.com/rss/search?q=site:oglobo.globo.com%20STF&hl=pt-BR&gl=BR&ceid=BR:pt-419"},
  {name:"Folha",url:"https://news.google.com/rss/search?q=site:folha.uol.com.br%20STF&hl=pt-BR&gl=BR&ceid=BR:pt-419"},
  {name:"Estad√£o",url:"https://news.google.com/rss/search?q=site:estadao.com.br%20STF&hl=pt-BR&gl=BR&ceid=BR:pt-419"},
  {name:"Valor",url:"https://news.google.com/rss/search?q=site:valor.globo.com%20STF&hl=pt-BR&gl=BR&ceid=BR:pt-419"},
  {name:"G1",url:"https://g1.globo.com/rss/g1/"}
];

const RSS2JSON = u=>`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(u)}`;
const els={
  list:document.getElementById("list"),
  refresh:document.getElementById("refreshBtn"),
  summary:document.getElementById("summaryBtn"),
  status:document.getElementById("status")
};

function normalize(t){
  return (t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}
function matches(item){
  const t=normalize(item.title+" "+item.description);
  return KEYWORDS.some(k=>t.includes(normalize(k)));
}

/* === RESOLVE LINK ORIGINAL (remove Google News) === */
function resolveOriginalLink(link){
  try{
    if(link.includes("news.google.com")){
      const u=new URL(link);
      const p=u.searchParams.get("url");
      if(p) return decodeURIComponent(p);
    }
    return link;
  }catch{ return link }
}

function formatBR(d){
  return new Intl.DateTimeFormat("pt-BR",{dateStyle:"short",timeStyle:"short"}).format(d);
}

let all=[];

/* ================= FETCH ================= */
async function fetchFeed(feed){
  const r=await fetch(RSS2JSON(feed.url));
  const j=await r.json();
  return (j.items||[]).map(i=>{
    const d=new Date(i.pubDate||i.date||i.isoDate||null);
    return{
      title:i.title||"(sem t√≠tulo)",
      link:resolveOriginalLink(i.link||""),
      description:i.description||"",
      source:feed.name,
      date:isNaN(d)?null:d
    };
  });
}

/* ================= RENDER ================= */
function render(){
  els.list.innerHTML="";
  if(!all.length){
    els.list.innerHTML="<div class='card'>Nenhuma not√≠cia.</div>";
    return;
  }
  all.forEach(n=>{
    const wa=`https://wa.me/?text=${encodeURIComponent(n.title+"\n"+n.link)}`;
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div class="pill">${n.source}</div>
      <h2 class="title"><a href="${n.link}" target="_blank">${n.title}</a></h2>
      <div class="date">${n.date?formatBR(n.date):""}</div>
      <div class="link"><a href="${n.link}" target="_blank">Abrir mat√©ria original</a></div>
      <div class="actions">
        <a href="${wa}" target="_blank"><button>WhatsApp</button></a>
        <button>üìã Copiar t√≠tulo + link</button>
      </div>`;
    card.querySelector("button:last-child").onclick=()=>{
      navigator.clipboard.writeText(n.title+"\n"+n.link);
      els.status.textContent="Copiado!";
      setTimeout(()=>els.status.textContent="Pronto.",1500);
    };
    els.list.appendChild(card);
  });
}

/* ================= RUN ================= */
async function run(){
  els.status.textContent="Atualizando‚Ä¶";
  let items=[];
  const res=await Promise.allSettled(FEEDS.map(fetchFeed));
  res.forEach(r=>r.status==="fulfilled"&&items.push(...r.value));
  const now=Date.now();
  all=[...new Map(items.filter(matches)
    .filter(i=>i.date&&(now-i.date.getTime())<=DISPLAY_HOURS*3600000)
    .sort((a,b)=>b.date-a.date)
    .map(i=>[i.link,i])).values()];
  render();
  els.status.textContent=`Atualizado ‚Ä¢ ${all.length} not√≠cia(s)`;
}

function summary(){
  const now=Date.now();
  const cut=now-SUMMARY_HOURS*3600000;
  let msg="Resumo STF\n\n";
  all.filter(n=>n.date&&n.date.getTime()>=cut)
     .forEach((n,i)=>msg+=`${i+1}) ${n.title}\n${n.link}\n\n`);
  window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
}

els.refresh.onclick=run;
els.summary.onclick=summary;
run();
</script>

</body>
</html>
